---
- name: "dci-openshift-agent : Setup openshift access"
  include_role:
    name: oc-setup

- name: "dci-openshift-agent : Setup podman on the jumphost"
  include_role:
    name: podman-setup

- name: "dci-openshift-agent : Side-load podman images prior to testing"
  include_role:
    name: image-side-load

- name: "dci-openshift-agent : Run Red Hat test suite"
  include_role:
    name: redhat-tests
  when:
    - dci_openshift_agent_conformance is defined
    - dci_openshift_agent_conformance | length > 0

# Setup and run cnf-tests
- block:

    - name: Create local git repo on jumphost for disconnected cnf-tests
      include_tasks: cnf-tests-git.yml
      when:
        - "'registry_host' in groups"
        - groups['registry_host'] | length > 0
        - cnf_tests_mode == "offline"

    - name: Mirror images to local registry for disconnected cnf-tests
      include_tasks: cnf-tests-mirror.yml
      when: cnf_tests_mode == "offline"

    - name: Run cnf tests
      include_tasks: cnf-tests-run.yml
      when: >
        cnf_tests_mode == "online" or cnf_tests_mode == "offline"

  when:
    - cnf_tests_mode is defined
...
